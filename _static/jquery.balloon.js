(function(d){var b={};b.pos=d.extend(["top","bottom","left","right"],{camel:["Top","Bottom","Left","Right"]});b.size=d.extend(["height","width"],{camel:["Height","Width"]});b.getRelativeNames=function(g){var f={pos:{o:g,f:(g%2===0)?g+1:g-1,p1:(g%2===0)?g:g-1,p2:(g%2===0)?g+1:g,c1:(g<2)?2:0,c2:(g<2)?3:1},size:{p:(g<2)?0:1,c:(g<2)?1:0}};var j={};for(var i in f){if(!j[i]){j[i]={}}for(var h in f[i]){j[i][h]=b[i][f[i][h]];if(!j.camel){j.camel={}}if(!j.camel[i]){j.camel[i]={}}j.camel[i][h]=b[i].camel[f[i][h]]}}j.isTopLeft=(j.pos.o===j.pos.p1);return j};function e(){this.initialize.apply(this,arguments)}(function(){var f={setBorder:function(j,i){return function(k){this.$.css("border-"+j.toLowerCase()+"-width",k+"px");this["border"+j]=k;return(this.isActive)?g(this,i):this}},setPosition:function(j,i){return function(k){this.$.css(j.toLowerCase(),k+"px");this[j.toLowerCase()]=k;return(this.isActive)?g(this,i):this}}};e.prototype={initialize:function(j){this.$=j;d.extend(true,this,this.$.offset(),{center:{},inner:{center:{}}});for(var k=0;k<b.pos.length;k++){this["border"+b.pos.camel[k]]=parseInt(this.$.css("border-"+b.pos[k]+"-width"))||0}this.active()},active:function(){this.isActive=true;g(this);return this},inactive:function(){this.isActive=false;return this}};for(var h=0;h<b.pos.length;h++){e.prototype["setBorder"+b.pos.camel[h]]=f.setBorder(b.pos.camel[h],(h<2));if(h%2===0){e.prototype["set"+b.pos.camel[h]]=f.setPosition(b.pos.camel[h],(h<2))}}function g(j,k){if(k==null){g(j,true);return g(j,false)}var i=b.getRelativeNames((k)?0:2);j[i.size.p]=j.$["outer"+i.camel.size.p]();j[i.pos.f]=j[i.pos.o]+j[i.size.p];j.center[i.pos.o]=j[i.pos.o]+j[i.size.p]/2;j.inner[i.pos.o]=j[i.pos.o]+j["border"+i.camel.pos.o];j.inner[i.size.p]=j.$["inner"+i.camel.size.p]();j.inner[i.pos.f]=j.inner[i.pos.o]+j.inner[i.size.p];j.inner.center[i.pos.o]=j.inner[i.pos.f]+j.inner[i.size.p]/2;return j}})();function a(g,o,q){o.stop(true,true);var l,r,n={position:"absolute",height:"0",width:"0",border:"solid 0 transparent"},k=new e(g),p=new e(o);p.setTop(-q.offsetY+((q.position&&q.position.indexOf("top")>=0)?k.top-p.height:((q.position&&q.position.indexOf("bottom")>=0)?k.bottom:k.center.top-p.height/2)));p.setLeft(q.offsetX+((q.position&&q.position.indexOf("left")>=0)?k.left-p.width:((q.position&&q.position.indexOf("right")>=0)?k.right:k.center.left-p.width/2)));if(q.tipSize>0){if(o.data("outerTip")){o.data("outerTip").remove();o.removeData("outerTip")}if(o.data("innerTip")){o.data("innerTip").remove();o.removeData("innerTip")}l=new e(d("<div>").css(n).appendTo(o));r=new e(d("<div>").css(n).appendTo(o));var h;for(var j=0;j<b.pos.length;j++){h=b.getRelativeNames(j);if(p.center[h.pos.c1]>=k[h.pos.c1]&&p.center[h.pos.c1]<=k[h.pos.c2]){if(j%2===0){if(p[h.pos.o]>=k[h.pos.o]&&p[h.pos.f]>=k[h.pos.f]){break}}else{if(p[h.pos.o]<=k[h.pos.o]&&p[h.pos.f]<=k[h.pos.f]){break}}}h=null}if(h){p["set"+h.camel.pos.p1](p[h.pos.p1]+((h.isTopLeft)?1:-1)*(q.tipSize-p["border"+h.camel.pos.o]));f(p,l,h,q.tipSize,o.css("border-"+h.pos.o+"-color"));f(p,r,h,q.tipSize-2*p["border"+h.camel.pos.o],o.css("background-color"));o.data("outerTip",l.$).data("innerTip",r.$)}else{d.each([l.$,r.$],function(){this.remove()})}}function f(w,v,s,u,t){var i=Math.round(u/1.7320508);v.inactive()["setBorder"+s.camel.pos.f](u)["setBorder"+s.camel.pos.c1](i)["setBorder"+s.camel.pos.c2](i)["set"+s.camel.pos.p1]((s.isTopLeft)?-u:w.inner[s.size.p])["set"+s.camel.pos.c1](w.inner[s.size.c]/2-i).active().$.css("border-"+s.pos.f+"-color",t)}}function c(g,h){var f=g.data("balloon")&&g.data("balloon").get(0);return !(f&&(f===h.relatedTarget||d.contains(f,h.relatedTarget)))}d.fn.balloon=function(f){return this.one("mouseenter touchstart",function g(k){var h=d(this),i=this;var j=h.off("mouseenter touchstart",g).showBalloon(f).on("mouseenter touchstart",function(l){c(h,l)&&h.showBalloon()}).data("balloon");if(j){j.on("mouseleave touchend",function(l){if(i===l.relatedTarget||d.contains(i,l.relatedTarget)){return}h.hideBalloon()}).on("mouseenter  touchstart",function(l){if(i===l.relatedTarget||d.contains(i,l.relatedTarget)){return}j.stop(true,true);h.showBalloon()})}}).on("mouseleave touchend",function(i){var h=d(this);c(h,i)&&h.hideBalloon()})};d.fn.showBalloon=function(g){var f,h;if(g||!this.data("options")){if(d.balloon.defaults.css===null){d.balloon.defaults.css={}}this.data("options",d.extend(true,{},d.balloon.defaults,g||{}))}g=this.data("options");return this.each(function(){var i,j;f=d(this);i=!f.data("balloon");h=f.data("balloon")||d("<div>");if(!i&&h.data("active")){return}h.data("active",true);clearTimeout(f.data("minLifetime"));j=d.isFunction(g.contents)?g.contents.apply(this):(g.contents||(g.contents=f.attr("title")||f.attr("alt")));h.append(j);if(!g.url&&h.html()===""){return}if(!i&&j!==h.html()){h.empty().append(j)}f.removeAttr("title");if(g.url){h.load(d.isFunction(g.url)?g.url(this):g.url,function(k,l,m){if(g.ajaxComplete){g.ajaxComplete(k,l,m)}a(f,h,g)})}if(i){h.addClass(g.classname).css(g.css||{}).css({visibility:"hidden",position:"absolute"}).appendTo("body");f.data("balloon",h);a(f,h,g);h.hide().css("visibility","visible")}else{a(f,h,g)}f.data("delay",setTimeout(function(){if(g.showAnimation){g.showAnimation.apply(h.stop(true,true),[g.showDuration,function(){g.showComplete&&g.showComplete.apply(h)}])}else{h.show(g.showDuration,function(){if(this.style.removeAttribute){this.style.removeAttribute("filter")}g.showComplete&&g.showComplete.apply(h)})}if(g.maxLifetime){clearTimeout(f.data("maxLifetime"));f.data("maxLifetime",setTimeout(function(){f.hideBalloon()},g.maxLifetime))}},g.delay))})};d.fn.hideBalloon=function(){var f=this.data("options");if(!this.data("balloon")){return this}return this.each(function(){var g=d(this);clearTimeout(g.data("delay"));clearTimeout(g.data("minLifetime"));g.data("minLifetime",setTimeout(function(){var h=g.data("balloon");if(f.hideAnimation){f.hideAnimation.apply(h.stop(true,true),[f.hideDuration,function(i){d(this).data("active",false);f.hideComplete&&f.hideComplete(i)}])}else{h.stop(true,true).hide(f.hideDuration,function(i){d(this).data("active",false);f.hideComplete&&f.hideComplete(i)})}},f.minLifetime))})};d.balloon={defaults:{contents:null,url:null,ajaxComplete:null,classname:null,position:"top",offsetX:0,offsetY:0,tipSize:12,delay:0,minLifetime:200,maxLifetime:0,showDuration:100,showAnimation:null,hideDuration:80,hideAnimation:function(f,g){this.fadeOut(f,g)},showComplete:null,hideComplete:null,css:{minWidth:"20px",padding:"5px",borderRadius:"6px",border:"solid 1px #777",boxShadow:"4px 4px 4px #555",color:"#666",backgroundColor:"#efefef",opacity:"0.85",zIndex:"32767",textAlign:"left"}}}})(jQuery);